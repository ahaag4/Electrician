<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - SHUKLA-ELECTRICALS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Quill Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #f59e0b;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }
        
        /* Rich Text Editor */
        .ql-toolbar.ql-snow {
            border: 1px solid #e5e7eb !important;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }
        
        .ql-container.ql-snow {
            border: 1px solid #e5e7eb !important;
            border-top: none !important;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            min-height: 200px;
        }
        
        /* Image Preview */
        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9fafb;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-active { background-color: #d1fae5; color: #065f46; }
        .status-inactive { background-color: #f3f4f6; color: #6b7280; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-published { background-color: #dbeafe; color: #1e40af; }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success { background-color: var(--primary); }
        .toast.error { background-color: var(--danger); }
        .toast.warning { background-color: var(--warning); }
        .toast.info { background-color: var(--info); }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full fade-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-bolt text-white text-2xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">SHUKLA-ELECTRICALS</h2>
                <p class="text-gray-600 mt-2">Admin Panel</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="email" value="admin@shuklaelectricals.com" required 
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" value="admin123" required 
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500">
                </div>
                <button type="submit" id="login-btn"
                        class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold">
                    <span id="login-text">Sign In</span>
                    <div id="login-spinner" class="spinner mx-auto hidden" style="width: 24px; height: 24px;"></div>
                </button>
                <button type="button" id="setup-admin-btn" 
                        class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold">
                    First Time Setup
                </button>
            </form>
            
            <div id="login-error" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm hidden"></div>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden">
        <!-- Mobile Menu -->
        <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-50 p-3 bg-green-600 text-white rounded-lg shadow-lg">
            <i class="fas fa-bars text-xl"></i>
        </button>
        
        <!-- Sidebar -->
        <div class="sidebar fixed inset-y-0 left-0 z-40 w-64 bg-gray-900 text-white transform md:translate-x-0 transition-transform">
            <div class="p-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-bolt text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">SHUKLA-ELECTRICALS</h1>
                        <p class="text-xs text-gray-400">Admin Panel</p>
                    </div>
                </div>
                <div class="mt-6 flex items-center space-x-3 p-3 bg-gray-800 rounded-lg">
                    <div class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-gray-300"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium" id="admin-name">Admin</p>
                        <p class="text-xs text-gray-400" id="admin-email">admin@shuklaelectricals.com</p>
                    </div>
                </div>
            </div>
            
            <nav class="mt-6 px-4">
                <a href="#dashboard" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-tachometer-alt w-5"></i>
                    <span>Dashboard</span>
                </a>
                
                <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2 px-4">Content</div>
                
                <a href="#services" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-bolt w-5"></i>
                    <span>Services</span>
                </a>
                
                <a href="#testimonials" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-star w-5"></i>
                    <span>Testimonials</span>
                </a>
                
                <a href="#partners" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-handshake w-5"></i>
                    <span>Partners</span>
                </a>
                
                <a href="#blog" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-blog w-5"></i>
                    <span>Blog Posts</span>
                </a>
                
                <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2 px-4">User Management</div>
                
                <a href="#contacts" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-envelope w-5"></i>
                    <span>Contacts</span>
                </a>
                
                <a href="#leads" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-user-plus w-5"></i>
                    <span>Leads</span>
                </a>
                
                <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mt-6 mb-2 px-4">Settings</div>
                
                <a href="#settings" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-cog w-5"></i>
                    <span>Website Settings</span>
                </a>
                
                <a href="#analytics" class="admin-nav flex items-center space-x-3 py-3 px-4 rounded-lg mb-1 hover:bg-gray-800">
                    <i class="fas fa-chart-bar w-5"></i>
                    <span>Analytics</span>
                </a>
                
                <button id="logout-btn" class="w-full text-left flex items-center space-x-3 py-3 px-4 rounded-lg mt-6 hover:bg-red-900 text-red-400">
                    <i class="fas fa-sign-out-alt w-5"></i>
                    <span>Logout</span>
                </button>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="md:ml-64 min-h-screen">
            <div class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800" id="page-title">Dashboard</h1>
                        <p class="text-sm text-gray-600" id="page-subtitle">Welcome to admin panel</p>
                    </div>
                </div>
            </div>
            
            <div id="content-area" class="p-6">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Modal Container -->
    <div id="modal-container"></div>
    
    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDGpagCpskeOxzVO4C5qgdVUTeWO8rUZUU",
            authDomain: "electrician-830b2.firebaseapp.com",
            databaseURL: "https://electrician-830b2-default-rtdb.firebaseio.com",
            projectId: "electrician-830b2",
            storageBucket: "electrician-830b2.firebasestorage.app",
            messagingSenderId: "1053791458330",
            appId: "1:1053791458330:web:fdbf5befa79aef2376eda3"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();
    </script>
    
    <!-- Main Admin Script -->
    <script>
        // Global Variables
        let currentUser = null;
        let currentPage = 'dashboard';
        let quillEditor = null;
        let editMode = false;
        let editItemId = null;
        
        // Toast Notification System
        class Toast {
            static show(message, type = 'info', duration = 4000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas ${this.getIcon(type)} mr-3"></i>
                            <span>${message}</span>
                        </div>
                        <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                container.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
            
            static getIcon(type) {
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                return icons[type] || 'fa-info-circle';
            }
        }
        
        // Modal System
        class Modal {
            static show(title, content, buttons = []) {
                const container = document.getElementById('modal-container');
                const modalId = 'modal-' + Date.now();
                
                const modalHTML = `
                    <div id="${modalId}" class="modal-overlay">
                        <div class="modal">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-xl font-semibold text-gray-800">${title}</h3>
                            </div>
                            <div class="p-6">
                                ${content}
                            </div>
                            ${buttons.length > 0 ? `
                                <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                                    ${buttons.map(btn => `
                                        <button onclick="${btn.onclick}"
                                                class="px-4 py-2 rounded-lg ${btn.primary ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'}">
                                            ${btn.text}
                                        </button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                container.innerHTML = modalHTML;
                const modal = document.getElementById(modalId);
                modal.classList.add('active');
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) this.close(modalId);
                });
                
                return modalId;
            }
            
            static close(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    setTimeout(() => modal.remove(), 300);
                }
            }
        }
        
        // ========== AUTHENTICATION ==========
        
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await login();
        });
        
        document.getElementById('setup-admin-btn').addEventListener('click', setupAdmin);
        
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('login-btn');
            const loginText = document.getElementById('login-text');
            const loginSpinner = document.getElementById('login-spinner');
            const loginError = document.getElementById('login-error');
            
            loginText.classList.add('hidden');
            loginSpinner.classList.remove('hidden');
            loginError.classList.add('hidden');
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Check if user exists in admin database
                const userRef = database.ref('admin/users/' + currentUser.uid);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    // Create admin user in database
                    await userRef.set({
                        email: currentUser.email,
                        name: 'Administrator',
                        role: 'admin',
                        createdAt: Date.now(),
                        lastLogin: Date.now()
                    });
                } else {
                    // Update last login
                    await userRef.update({ lastLogin: Date.now() });
                }
                
                Toast.show('Login successful!', 'success');
                
                // Store user session
                localStorage.setItem('adminUser', JSON.stringify({
                    uid: currentUser.uid,
                    email: currentUser.email
                }));
                
                // Show admin panel
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                
                document.getElementById('admin-name').textContent = 'Administrator';
                document.getElementById('admin-email').textContent = currentUser.email;
                
                loadDashboard();
                
            } catch (error) {
                console.error('Login error:', error);
                loginError.textContent = error.message;
                loginError.classList.remove('hidden');
                Toast.show('Login failed: ' + error.message, 'error');
            } finally {
                loginText.classList.remove('hidden');
                loginSpinner.classList.add('hidden');
            }
        }
        
        async function setupAdmin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                // Create user in Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Create admin entry in database
                await database.ref('admin/users/' + userCredential.user.uid).set({
                    email: email,
                    name: 'Administrator',
                    role: 'admin',
                    createdAt: Date.now()
                });
                
                Toast.show('Admin account created successfully! You can now login.', 'success');
                
                // Sign out to let user login again
                await auth.signOut();
                
            } catch (error) {
                Toast.show('Setup failed: ' + error.message, 'error');
            }
        }
        
        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                await auth.signOut();
                localStorage.removeItem('adminUser');
                document.getElementById('admin-panel').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
                Toast.show('Logged out successfully', 'success');
            } catch (error) {
                Toast.show('Logout failed', 'error');
            }
        });
        
        // Check existing session
        function checkAuth() {
            const savedUser = localStorage.getItem('adminUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                auth.onAuthStateChanged(async (firebaseUser) => {
                    if (firebaseUser && firebaseUser.uid === user.uid) {
                        currentUser = firebaseUser;
                        document.getElementById('login-screen').classList.add('hidden');
                        document.getElementById('admin-panel').classList.remove('hidden');
                        document.getElementById('admin-email').textContent = currentUser.email;
                        loadDashboard();
                    }
                });
            }
        }
        
        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            document.querySelector('.sidebar').classList.toggle('active');
        });
        
        // Navigation
        document.querySelectorAll('.admin-nav').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const href = link.getAttribute('href').substring(1);
                loadPage(href);
                
                // Update active nav
                document.querySelectorAll('.admin-nav').forEach(nav => {
                    nav.classList.remove('bg-gray-800', 'text-green-400');
                });
                link.classList.add('bg-gray-800', 'text-green-400');
                
                // Close mobile menu
                if (window.innerWidth < 768) {
                    document.querySelector('.sidebar').classList.remove('active');
                }
            });
        });
        
        // ========== PAGE LOADING ==========
        
        async function loadPage(page) {
            currentPage = page;
            
            const titles = {
                dashboard: 'Dashboard',
                services: 'Services Management',
                testimonials: 'Testimonials Management',
                partners: 'Partners Management',
                blog: 'Blog Management',
                contacts: 'Contact Messages',
                leads: 'Lead Management',
                settings: 'Website Settings',
                analytics: 'Analytics Dashboard'
            };
            
            document.getElementById('page-title').textContent = titles[page] || page;
            document.getElementById('page-subtitle').textContent = `Manage ${titles[page] || page}`;
            
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = `
                <div class="text-center py-12">
                    <div class="spinner mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading...</p>
                </div>
            `;
            
            switch(page) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'services':
                    await loadServices();
                    break;
                case 'testimonials':
                    await loadTestimonials();
                    break;
                case 'partners':
                    await loadPartners();
                    break;
                case 'blog':
                    await loadBlog();
                    break;
                case 'contacts':
                    await loadContacts();
                    break;
                case 'leads':
                    await loadLeads();
                    break;
                case 'settings':
                    await loadSettings();
                    break;
                case 'analytics':
                    await loadAnalytics();
                    break;
            }
        }
        
        // ========== DASHBOARD ==========
        
        async function loadDashboard() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const [services, testimonials, partners, blogPosts, contacts, leads] = await Promise.all([
                    database.ref('services').once('value'),
                    database.ref('testimonials').once('value'),
                    database.ref('partners').once('value'),
                    database.ref('blog/posts').once('value'),
                    database.ref('contacts').once('value'),
                    database.ref('leads').once('value')
                ]);
                
                const stats = {
                    services: services.numChildren(),
                    testimonials: testimonials.numChildren(),
                    partners: partners.numChildren(),
                    blogPosts: blogPosts.numChildren(),
                    contacts: contacts.numChildren(),
                    leads: leads.numChildren()
                };
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Services</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.services}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-bolt text-green-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Testimonials</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.testimonials}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-star text-blue-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Partners</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.partners}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-handshake text-purple-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Blog Posts</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.blogPosts}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-blog text-orange-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="showAddServiceModal()" class="p-4 bg-gray-50 hover:bg-green-50 rounded-lg border border-gray-200 hover:border-green-300">
                                        <i class="fas fa-plus text-green-600 mb-2"></i>
                                        <p class="font-medium">Add Service</p>
                                    </button>
                                    <button onclick="showAddBlogModal()" class="p-4 bg-gray-50 hover:bg-blue-50 rounded-lg border border-gray-200 hover:border-blue-300">
                                        <i class="fas fa-edit text-blue-600 mb-2"></i>
                                        <p class="font-medium">Write Blog</p>
                                    </button>
                                    <button onclick="loadPage('contacts')" class="p-4 bg-gray-50 hover:bg-purple-50 rounded-lg border border-gray-200 hover:border-purple-300">
                                        <i class="fas fa-envelope text-purple-600 mb-2"></i>
                                        <p class="font-medium">View Messages</p>
                                    </button>
                                    <button onclick="loadPage('analytics')" class="p-4 bg-gray-50 hover:bg-orange-50 rounded-lg border border-gray-200 hover:border-orange-300">
                                        <i class="fas fa-chart-line text-orange-600 mb-2"></i>
                                        <p class="font-medium">Analytics</p>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Contacts</h3>
                                <div class="space-y-4">
                                    ${Object.entries(contacts.val() || {}).slice(0, 3).map(([id, contact]) => `
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <div>
                                                <p class="font-medium">${contact.name}</p>
                                                <p class="text-sm text-gray-600">${contact.email}</p>
                                            </div>
                                            <span class="text-sm text-gray-500">${formatDate(contact.timestamp)}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Dashboard</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ========== SERVICES MANAGEMENT ==========
        
        async function loadServices() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('services').once('value');
                const services = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Services Management</h2>
                                <p class="text-gray-600">Manage electrical services</p>
                            </div>
                            <button onclick="showAddServiceModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                                <i class="fas fa-plus mr-2"></i> Add Service
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Icon</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${Object.keys(services).length > 0 ? 
                                            Object.entries(services).map(([id, service]) => `
                                                <tr>
                                                    <td class="px-6 py-4">
                                                        <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
                                                            <i class="${service.icon || 'fas fa-bolt'} text-green-600"></i>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 font-medium">${service.title}</td>
                                                    <td class="px-6 py-4 text-sm text-gray-600 max-w-xs truncate">${service.description}</td>
                                                    <td class="px-6 py-4">
                                                        <span class="status-badge ${service.active ? 'status-active' : 'status-inactive'}">
                                                            ${service.active ? 'Active' : 'Inactive'}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <div class="flex space-x-2">
                                                            <button onclick="editService('${id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button onclick="deleteService('${id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                                                        <i class="fas fa-inbox text-3xl mb-2"></i>
                                                        <p>No services found. Add your first service!</p>
                                                    </td>
                                                </tr>
                                            `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Services</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function showAddServiceModal(editId = null) {
            editMode = !!editId;
            editItemId = editId;
            
            if (editMode && editId) {
                database.ref('services/' + editId).once('value').then(snapshot => {
                    const service = snapshot.val();
                    showServiceModal(service);
                });
            } else {
                showServiceModal();
            }
        }
        
        function showServiceModal(service = null) {
            const modalId = Modal.show(
                editMode ? 'Edit Service' : 'Add New Service',
                `
                <form id="service-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Service Title *</label>
                        <input type="text" id="service-title" required 
                               value="${service?.title || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                        <textarea id="service-description" required rows="3"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">${service?.description || ''}</textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Icon</label>
                            <select id="service-icon" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                <option value="fas fa-bolt" ${service?.icon === 'fas fa-bolt' ? 'selected' : ''}>Bolt</option>
                                <option value="fas fa-lightbulb" ${service?.icon === 'fas fa-lightbulb' ? 'selected' : ''}>Lightbulb</option>
                                <option value="fas fa-plug" ${service?.icon === 'fas fa-plug' ? 'selected' : ''}>Plug</option>
                                <option value="fas fa-tools" ${service?.icon === 'fas fa-tools' ? 'selected' : ''}>Tools</option>
                                <option value="fas fa-home" ${service?.icon === 'fas fa-home' ? 'selected' : ''}>Home</option>
                                <option value="fas fa-building" ${service?.icon === 'fas fa-building' ? 'selected' : ''}>Building</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                            <select id="service-category" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                <option value="Residential" ${service?.category === 'Residential' ? 'selected' : ''}>Residential</option>
                                <option value="Commercial" ${service?.category === 'Commercial' ? 'selected' : ''}>Commercial</option>
                                <option value="Industrial" ${service?.category === 'Industrial' ? 'selected' : ''}>Industrial</option>
                                <option value="Emergency" ${service?.category === 'Emergency' ? 'selected' : ''}>Emergency</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="service-active" ${service?.active !== false ? 'checked' : ''} class="mr-2">
                        <label for="service-active" class="text-sm text-gray-700">Active</label>
                    </div>
                </form>
                `,
                [
                    { text: 'Cancel', onclick: `Modal.close('${modalId}')` },
                    { 
                        text: editMode ? 'Update Service' : 'Add Service', 
                        primary: true, 
                        onclick: editMode ? `saveService('${modalId}', '${editItemId}')` : `saveService('${modalId}')` 
                    }
                ]
            );
        }
        
        async function saveService(modalId, editId = null) {
            try {
                const serviceData = {
                    title: document.getElementById('service-title').value,
                    description: document.getElementById('service-description').value,
                    icon: document.getElementById('service-icon').value,
                    category: document.getElementById('service-category').value,
                    active: document.getElementById('service-active').checked,
                    updatedAt: Date.now()
                };
                
                if (editId) {
                    await database.ref('services/' + editId).update(serviceData);
                    Toast.show('Service updated successfully!', 'success');
                } else {
                    serviceData.createdAt = Date.now();
                    await database.ref('services').push(serviceData);
                    Toast.show('Service added successfully!', 'success');
                }
                
                Modal.close(modalId);
                loadServices();
            } catch (error) {
                Toast.show('Error saving service: ' + error.message, 'error');
            }
        }
        
        async function editService(id) {
            showAddServiceModal(id);
        }
        
        async function deleteService(id) {
            if (confirm('Are you sure you want to delete this service?')) {
                try {
                    await database.ref('services/' + id).remove();
                    Toast.show('Service deleted successfully!', 'success');
                    loadServices();
                } catch (error) {
                    Toast.show('Error deleting service: ' + error.message, 'error');
                }
            }
        }
        
        // ========== TESTIMONIALS MANAGEMENT ==========
        
        async function loadTestimonials() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('testimonials').once('value');
                const testimonials = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Testimonials Management</h2>
                                <p class="text-gray-600">Manage customer testimonials</p>
                            </div>
                            <button onclick="showAddTestimonialModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                                <i class="fas fa-plus mr-2"></i> Add Testimonial
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${Object.keys(testimonials).length > 0 ? 
                                Object.entries(testimonials).map(([id, testimonial]) => `
                                    <div class="bg-white rounded-xl border border-gray-200 p-6">
                                        <div class="flex items-center space-x-4 mb-4">
                                            <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                                                ${testimonial.name.charAt(0)}
                                            </div>
                                            <div>
                                                <h4 class="font-semibold">${testimonial.name}</h4>
                                                <p class="text-sm text-gray-600">${testimonial.position || 'Customer'}</p>
                                            </div>
                                        </div>
                                        <p class="text-gray-700 mb-4">"${testimonial.content}"</p>
                                        <div class="flex items-center justify-between">
                                            <div class="flex text-yellow-400">
                                                ${'â˜…'.repeat(testimonial.rating || 5)}
                                            </div>
                                            <div class="flex space-x-2">
                                                <button onclick="editTestimonial('${id}')" class="p-1 text-blue-600">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteTestimonial('${id}')" class="p-1 text-red-600">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div class="col-span-3 text-center py-12 text-gray-500">
                                        <i class="fas fa-comments text-4xl mb-4"></i>
                                        <p class="text-lg">No testimonials yet</p>
                                        <p class="text-sm mt-2">Add your first customer testimonial</p>
                                    </div>
                                `}
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Testimonials</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function showAddTestimonialModal(editId = null) {
            editMode = !!editId;
            editItemId = editId;
            
            if (editMode && editId) {
                database.ref('testimonials/' + editId).once('value').then(snapshot => {
                    const testimonial = snapshot.val();
                    showTestimonialModal(testimonial);
                });
            } else {
                showTestimonialModal();
            }
        }
        
        function showTestimonialModal(testimonial = null) {
            const modalId = Modal.show(
                editMode ? 'Edit Testimonial' : 'Add Testimonial',
                `
                <form id="testimonial-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Name *</label>
                        <input type="text" id="testimonial-name" required 
                               value="${testimonial?.name || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Position/Company</label>
                        <input type="text" id="testimonial-position" 
                               value="${testimonial?.position || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Testimonial Content *</label>
                        <textarea id="testimonial-content" required rows="4"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">${testimonial?.content || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rating (1-5)</label>
                        <select id="testimonial-rating" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                            <option value="5" ${testimonial?.rating === 5 ? 'selected' : ''}>â˜…â˜…â˜…â˜…â˜…</option>
                            <option value="4" ${testimonial?.rating === 4 ? 'selected' : ''}>â˜…â˜…â˜…â˜…â˜†</option>
                            <option value="3" ${testimonial?.rating === 3 ? 'selected' : ''}>â˜…â˜…â˜…â˜†â˜†</option>
                            <option value="2" ${testimonial?.rating === 2 ? 'selected' : ''}>â˜…â˜…â˜†â˜†â˜†</option>
                            <option value="1" ${testimonial?.rating === 1 ? 'selected' : ''}>â˜…â˜†â˜†â˜†â˜†</option>
                        </select>
                    </div>
                </form>
                `,
                [
                    { text: 'Cancel', onclick: `Modal.close('${modalId}')` },
                    { 
                        text: editMode ? 'Update Testimonial' : 'Add Testimonial', 
                        primary: true, 
                        onclick: editMode ? `saveTestimonial('${modalId}', '${editItemId}')` : `saveTestimonial('${modalId}')` 
                    }
                ]
            );
        }
        
        async function saveTestimonial(modalId, editId = null) {
            try {
                const testimonialData = {
                    name: document.getElementById('testimonial-name').value,
                    position: document.getElementById('testimonial-position').value,
                    content: document.getElementById('testimonial-content').value,
                    rating: parseInt(document.getElementById('testimonial-rating').value),
                    updatedAt: Date.now()
                };
                
                if (editId) {
                    await database.ref('testimonials/' + editId).update(testimonialData);
                    Toast.show('Testimonial updated successfully!', 'success');
                } else {
                    testimonialData.createdAt = Date.now();
                    await database.ref('testimonials').push(testimonialData);
                    Toast.show('Testimonial added successfully!', 'success');
                }
                
                Modal.close(modalId);
                loadTestimonials();
            } catch (error) {
                Toast.show('Error saving testimonial: ' + error.message, 'error');
            }
        }
        
        async function editTestimonial(id) {
            showAddTestimonialModal(id);
        }
        
        async function deleteTestimonial(id) {
            if (confirm('Are you sure you want to delete this testimonial?')) {
                try {
                    await database.ref('testimonials/' + id).remove();
                    Toast.show('Testimonial deleted successfully!', 'success');
                    loadTestimonials();
                } catch (error) {
                    Toast.show('Error deleting testimonial: ' + error.message, 'error');
                }
            }
        }
        
        // ========== PARTNERS MANAGEMENT ==========
        
        async function loadPartners() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('partners').once('value');
                const partners = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Partners Management</h2>
                                <p class="text-gray-600">Manage business partners</p>
                            </div>
                            <button onclick="showAddPartnerModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                                <i class="fas fa-plus mr-2"></i> Add Partner
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Website</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${Object.keys(partners).length > 0 ? 
                                            Object.entries(partners).map(([id, partner]) => `
                                                <tr>
                                                    <td class="px-6 py-4 font-medium">${partner.name}</td>
                                                    <td class="px-6 py-4">
                                                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm">${partner.type || 'Partner'}</span>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <a href="${partner.website}" target="_blank" class="text-blue-600 hover:underline">${partner.website}</a>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <span class="status-badge ${partner.active ? 'status-active' : 'status-inactive'}">
                                                            ${partner.active ? 'Active' : 'Inactive'}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <div class="flex space-x-2">
                                                            <button onclick="editPartner('${id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button onclick="deletePartner('${id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                                                        <i class="fas fa-handshake text-3xl mb-2"></i>
                                                        <p>No partners found. Add your first partner!</p>
                                                    </td>
                                                </tr>
                                            `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Partners</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function showAddPartnerModal(editId = null) {
            editMode = !!editId;
            editItemId = editId;
            
            if (editMode && editId) {
                database.ref('partners/' + editId).once('value').then(snapshot => {
                    const partner = snapshot.val();
                    showPartnerModal(partner);
                });
            } else {
                showPartnerModal();
            }
        }
        
        function showPartnerModal(partner = null) {
            const modalId = Modal.show(
                editMode ? 'Edit Partner' : 'Add Partner',
                `
                <form id="partner-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Partner Name *</label>
                        <input type="text" id="partner-name" required 
                               value="${partner?.name || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Website URL *</label>
                        <input type="url" id="partner-website" required 
                               value="${partner?.website || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Partner Type</label>
                        <select id="partner-type" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                            <option value="Manufacturer" ${partner?.type === 'Manufacturer' ? 'selected' : ''}>Manufacturer</option>
                            <option value="Distributor" ${partner?.type === 'Distributor' ? 'selected' : ''}>Distributor</option>
                            <option value="Contractor" ${partner?.type === 'Contractor' ? 'selected' : ''}>Contractor</option>
                            <option value="Supplier" ${partner?.type === 'Supplier' ? 'selected' : ''}>Supplier</option>
                            <option value="Service Provider" ${partner?.type === 'Service Provider' ? 'selected' : ''}>Service Provider</option>
                        </select>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="partner-active" ${partner?.active !== false ? 'checked' : ''} class="mr-2">
                        <label for="partner-active" class="text-sm text-gray-700">Active</label>
                    </div>
                </form>
                `,
                [
                    { text: 'Cancel', onclick: `Modal.close('${modalId}')` },
                    { 
                        text: editMode ? 'Update Partner' : 'Add Partner', 
                        primary: true, 
                        onclick: editMode ? `savePartner('${modalId}', '${editItemId}')` : `savePartner('${modalId}')` 
                    }
                ]
            );
        }
        
        async function savePartner(modalId, editId = null) {
            try {
                const partnerData = {
                    name: document.getElementById('partner-name').value,
                    website: document.getElementById('partner-website').value,
                    type: document.getElementById('partner-type').value,
                    active: document.getElementById('partner-active').checked,
                    updatedAt: Date.now()
                };
                
                if (editId) {
                    await database.ref('partners/' + editId).update(partnerData);
                    Toast.show('Partner updated successfully!', 'success');
                } else {
                    partnerData.createdAt = Date.now();
                    await database.ref('partners').push(partnerData);
                    Toast.show('Partner added successfully!', 'success');
                }
                
                Modal.close(modalId);
                loadPartners();
            } catch (error) {
                Toast.show('Error saving partner: ' + error.message, 'error');
            }
        }
        
        async function editPartner(id) {
            showAddPartnerModal(id);
        }
        
        async function deletePartner(id) {
            if (confirm('Are you sure you want to delete this partner?')) {
                try {
                    await database.ref('partners/' + id).remove();
                    Toast.show('Partner deleted successfully!', 'success');
                    loadPartners();
                } catch (error) {
                    Toast.show('Error deleting partner: ' + error.message, 'error');
                }
            }
        }
        
        // ========== BLOG MANAGEMENT ==========
        
        async function loadBlog() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('blog/posts').once('value');
                const posts = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Blog Management</h2>
                                <p class="text-gray-600">Manage blog posts</p>
                            </div>
                            <button onclick="showAddBlogModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                                <i class="fas fa-plus mr-2"></i> New Post
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Views</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${Object.keys(posts).length > 0 ? 
                                            Object.entries(posts).map(([id, post]) => `
                                                <tr>
                                                    <td class="px-6 py-4 font-medium">${post.title}</td>
                                                    <td class="px-6 py-4">
                                                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm">${post.category || 'General'}</span>
                                                    </td>
                                                    <td class="px-6 py-4">${formatDate(post.timestamp)}</td>
                                                    <td class="px-6 py-4">
                                                        <span class="status-badge ${post.published ? 'status-published' : 'status-pending'}">
                                                            ${post.published ? 'Published' : 'Draft'}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4">${post.views || 0}</td>
                                                    <td class="px-6 py-4">
                                                        <div class="flex space-x-2">
                                                            <button onclick="viewBlogPost('${id}')" class="p-2 text-green-600 hover:bg-green-50 rounded-lg">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                            <button onclick="editBlogPost('${id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg">
                                                                <i class="fas fa-edit"></i>
                                                            </button>
                                                            <button onclick="deleteBlogPost('${id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                                        <i class="fas fa-newspaper text-3xl mb-2"></i>
                                                        <p>No blog posts found. Create your first post!</p>
                                                    </td>
                                                </tr>
                                            `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Blog Posts</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function showAddBlogModal(editId = null) {
            editMode = !!editId;
            editItemId = editId;
            
            if (editMode && editId) {
                database.ref('blog/posts/' + editId).once('value').then(snapshot => {
                    const post = snapshot.val();
                    showBlogModal(post);
                });
            } else {
                showBlogModal();
            }
        }
        
        function showBlogModal(post = null) {
            const modalId = Modal.show(
                editMode ? 'Edit Blog Post' : 'New Blog Post',
                `
                <form id="blog-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Post Title *</label>
                        <input type="text" id="blog-title" required 
                               value="${post?.title || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Excerpt</label>
                        <textarea id="blog-excerpt" rows="2"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300">${post?.excerpt || ''}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Content *</label>
                        <div id="editor-container" style="height: 200px;">${post?.content || ''}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                            <select id="blog-category" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                <option value="Electrical Safety" ${post?.category === 'Electrical Safety' ? 'selected' : ''}>Electrical Safety</option>
                                <option value="Installation" ${post?.category === 'Installation' ? 'selected' : ''}>Installation</option>
                                <option value="Maintenance" ${post?.category === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                                <option value="Energy Saving" ${post?.category === 'Energy Saving' ? 'selected' : ''}>Energy Saving</option>
                                <option value="Tips & Tricks" ${post?.category === 'Tips & Tricks' ? 'selected' : ''}>Tips & Tricks</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Read Time (minutes)</label>
                            <input type="number" id="blog-read-time" min="1" 
                                   value="${post?.readTime || 5}"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Featured Image URL</label>
                        <input type="url" id="blog-image" 
                               value="${post?.imageUrl || ''}"
                               class="w-full px-4 py-2 rounded-lg border border-gray-300"
                               placeholder="https://example.com/image.jpg">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="blog-published" ${post?.published ? 'checked' : ''} class="mr-2">
                        <label for="blog-published" class="text-sm text-gray-700">Publish immediately</label>
                    </div>
                </form>
                `,
                [
                    { text: 'Cancel', onclick: `Modal.close('${modalId}')` },
                    { 
                        text: editMode ? 'Update Post' : 'Publish Post', 
                        primary: true, 
                        onclick: editMode ? `saveBlogPost('${modalId}', '${editItemId}')` : `saveBlogPost('${modalId}')` 
                    }
                ]
            );
            
            // Initialize Quill editor
            setTimeout(() => {
                if (!quillEditor) {
                    quillEditor = new Quill('#editor-container', {
                        theme: 'snow',
                        modules: {
                            toolbar: [
                                ['bold', 'italic', 'underline'],
                                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                ['link', 'image'],
                                ['clean']
                            ]
                        }
                    });
                }
                
                if (post?.content) {
                    quillEditor.root.innerHTML = post.content;
                }
            }, 100);
        }
        
        async function saveBlogPost(modalId, editId = null) {
            try {
                const blogData = {
                    title: document.getElementById('blog-title').value,
                    excerpt: document.getElementById('blog-excerpt').value,
                    content: quillEditor ? quillEditor.root.innerHTML : '',
                    category: document.getElementById('blog-category').value,
                    readTime: parseInt(document.getElementById('blog-read-time').value) || 5,
                    imageUrl: document.getElementById('blog-image').value,
                    published: document.getElementById('blog-published').checked,
                    updatedAt: Date.now(),
                    author: currentUser.email.split('@')[0] || 'Admin'
                };
                
                if (editId) {
                    await database.ref('blog/posts/' + editId).update(blogData);
                    Toast.show('Blog post updated successfully!', 'success');
                } else {
                    blogData.createdAt = Date.now();
                    blogData.timestamp = Date.now();
                    blogData.views = 0;
                    await database.ref('blog/posts').push(blogData);
                    Toast.show('Blog post published successfully!', 'success');
                }
                
                Modal.close(modalId);
                loadBlog();
            } catch (error) {
                Toast.show('Error saving blog post: ' + error.message, 'error');
            }
        }
        
        function viewBlogPost(id) {
            window.open(`post.html?id=${id}`, '_blank');
        }
        
        async function editBlogPost(id) {
            showAddBlogModal(id);
        }
        
        async function deleteBlogPost(id) {
            if (confirm('Are you sure you want to delete this blog post?')) {
                try {
                    await database.ref('blog/posts/' + id).remove();
                    Toast.show('Blog post deleted successfully!', 'success');
                    loadBlog();
                } catch (error) {
                    Toast.show('Error deleting blog post: ' + error.message, 'error');
                }
            }
        }
        
        // ========== CONTACTS MANAGEMENT ==========
        
        async function loadContacts() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('contacts').once('value');
                const contacts = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Contact Messages</h2>
                                <p class="text-gray-600">Manage customer inquiries</p>
                            </div>
                            <button onclick="exportContacts()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                                <i class="fas fa-download mr-2"></i> Export CSV
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Subject</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${Object.keys(contacts).length > 0 ? 
                                            Object.entries(contacts).map(([id, contact]) => `
                                                <tr>
                                                    <td class="px-6 py-4 font-medium">${contact.name}</td>
                                                    <td class="px-6 py-4">${contact.email}</td>
                                                    <td class="px-6 py-4">${contact.subject}</td>
                                                    <td class="px-6 py-4">${formatDate(contact.timestamp)}</td>
                                                    <td class="px-6 py-4">
                                                        <span class="status-badge ${contact.read ? 'status-inactive' : 'status-pending'}">
                                                            ${contact.read ? 'Read' : 'Unread'}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <div class="flex space-x-2">
                                                            <button onclick="viewContact('${id}')" class="p-2 text-green-600 hover:bg-green-50 rounded-lg">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                            <button onclick="deleteContact('${id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                                        <i class="fas fa-inbox text-3xl mb-2"></i>
                                                        <p>No messages found</p>
                                                    </td>
                                                </tr>
                                            `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Messages</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function viewContact(id) {
            try {
                const snapshot = await database.ref('contacts/' + id).once('value');
                const contact = snapshot.val();
                
                // Mark as read
                await database.ref('contacts/' + id).update({ read: true });
                
                const modalId = Modal.show(
                    'Contact Message',
                    `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">From</label>
                            <p class="text-gray-900">${contact.name} &lt;${contact.email}&gt;</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                            <p class="text-gray-900">${contact.subject}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-gray-900 whitespace-pre-wrap">${contact.message}</p>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Received</label>
                            <p class="text-gray-900">${formatDate(contact.timestamp)}</p>
                        </div>
                    </div>
                    `,
                    [
                        { text: 'Close', onclick: `Modal.close('${modalId}')` },
                        { 
                            text: 'Reply via Email', 
                            primary: true, 
                            onclick: `window.location.href='mailto:${contact.email}?subject=Re: ${contact.subject}';` 
                        }
                    ]
                );
                
                // Reload contacts to update read status
                loadContacts();
                
            } catch (error) {
                Toast.show('Error viewing message: ' + error.message, 'error');
            }
        }
        
        async function deleteContact(id) {
            if (confirm('Are you sure you want to delete this message?')) {
                try {
                    await database.ref('contacts/' + id).remove();
                    Toast.show('Message deleted successfully!', 'success');
                    loadContacts();
                } catch (error) {
                    Toast.show('Error deleting message: ' + error.message, 'error');
                }
            }
        }
        
        async function exportContacts() {
            try {
                const snapshot = await database.ref('contacts').once('value');
                const contacts = snapshot.val() || {};
                
                let csv = 'Name,Email,Subject,Message,Date\n';
                Object.values(contacts).forEach(contact => {
                    csv += `"${contact.name}","${contact.email}","${contact.subject}","${contact.message}",${formatDate(contact.timestamp)}\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'contacts_' + new Date().toISOString().split('T')[0] + '.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                Toast.show('Contacts exported successfully!', 'success');
            } catch (error) {
                Toast.show('Error exporting contacts: ' + error.message, 'error');
            }
        }
        
        // ========== LEADS MANAGEMENT ==========
        
        async function loadLeads() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('leads').once('value');
                const leads = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Lead Management</h2>
                                <p class="text-gray-600">Manage potential customer leads</p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Service</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${Object.keys(leads).length > 0 ? 
                                            Object.entries(leads).map(([id, lead]) => `
                                                <tr>
                                                    <td class="px-6 py-4 font-medium">${lead.name}</td>
                                                    <td class="px-6 py-4">${lead.phone}</td>
                                                    <td class="px-6 py-4">
                                                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm">${lead.service}</span>
                                                    </td>
                                                    <td class="px-6 py-4">${formatDate(lead.timestamp)}</td>
                                                    <td class="px-6 py-4">
                                                        <select onchange="updateLeadStatus('${id}', this.value)" 
                                                                class="text-sm rounded-lg border-gray-300">
                                                            <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
                                                            <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                                                            <option value="quoted" ${lead.status === 'quoted' ? 'selected' : ''}>Quoted</option>
                                                            <option value="converted" ${lead.status === 'converted' ? 'selected' : ''}>Converted</option>
                                                            <option value="lost" ${lead.status === 'lost' ? 'selected' : ''}>Lost</option>
                                                        </select>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <div class="flex space-x-2">
                                                            <button onclick="viewLead('${id}')" class="p-2 text-green-600 hover:bg-green-50 rounded-lg">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                            <button onclick="deleteLead('${id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                                        <i class="fas fa-users text-3xl mb-2"></i>
                                                        <p>No leads found</p>
                                                    </td>
                                                </tr>
                                            `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Leads</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function updateLeadStatus(id, status) {
            try {
                await database.ref('leads/' + id).update({ status: status });
                Toast.show('Lead status updated!', 'success');
            } catch (error) {
                Toast.show('Error updating lead: ' + error.message, 'error');
            }
        }
        
        async function viewLead(id) {
            try {
                const snapshot = await database.ref('leads/' + id).once('value');
                const lead = snapshot.val();
                
                const modalId = Modal.show(
                    'Lead Details',
                    `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                            <p class="text-gray-900">${lead.name}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <p class="text-gray-900">${lead.email || 'Not provided'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <p class="text-gray-900">${lead.phone}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Service Required</label>
                            <p class="text-gray-900">${lead.service}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-gray-900 whitespace-pre-wrap">${lead.message || 'No message'}</p>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Submitted</label>
                            <p class="text-gray-900">${formatDate(lead.timestamp)}</p>
                        </div>
                    </div>
                    `,
                    [
                        { text: 'Close', onclick: `Modal.close('${modalId}')` },
                        { 
                            text: 'Contact Lead', 
                            primary: true, 
                            onclick: `window.location.href='tel:${lead.phone}';` 
                        }
                    ]
                );
                
            } catch (error) {
                Toast.show('Error viewing lead: ' + error.message, 'error');
            }
        }
        
        async function deleteLead(id) {
            if (confirm('Are you sure you want to delete this lead?')) {
                try {
                    await database.ref('leads/' + id).remove();
                    Toast.show('Lead deleted successfully!', 'success');
                    loadLeads();
                } catch (error) {
                    Toast.show('Error deleting lead: ' + error.message, 'error');
                }
            }
        }
        
        // ========== WEBSITE SETTINGS ==========
        
        async function loadSettings() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const snapshot = await database.ref('settings').once('value');
                const settings = snapshot.val() || {};
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Website Settings</h2>
                                <p class="text-gray-600">Configure website preferences</p>
                            </div>
                            <button onclick="saveSettings()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                                <i class="fas fa-save mr-2"></i> Save Settings
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <form id="settings-form" class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">General Settings</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Website Name</label>
                                            <input type="text" name="siteName" value="${settings.siteName || 'SHUKLA-ELECTRICALS'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Contact Email</label>
                                            <input type="email" name="contactEmail" value="${settings.contactEmail || 'info@shuklaelectricals.com'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                            <input type="tel" name="phone" value="${settings.phone || '(123) 456-7890'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                            <input type="text" name="address" value="${settings.address || '123 Electrical Street, City, State 12345'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Social Media</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Facebook</label>
                                            <input type="url" name="facebook" value="${settings.facebook || ''}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Twitter</label>
                                            <input type="url" name="twitter" value="${settings.twitter || ''}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                                            <input type="url" name="instagram" value="${settings.instagram || ''}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn</label>
                                            <input type="url" name="linkedin" value="${settings.linkedin || ''}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Business Hours</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Weekdays</label>
                                            <input type="text" name="weekdaysHours" value="${settings.weekdaysHours || '9:00 AM - 6:00 PM'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Saturday</label>
                                            <input type="text" name="saturdayHours" value="${settings.saturdayHours || '10:00 AM - 4:00 PM'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Sunday</label>
                                            <input type="text" name="sundayHours" value="${settings.sundayHours || 'Emergency Only'}" 
                                                   class="w-full px-4 py-2 rounded-lg border border-gray-300">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Maintenance Mode</h3>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="maintenanceMode" ${settings.maintenanceMode ? 'checked' : ''} 
                                               id="maintenanceMode" class="mr-2">
                                        <label for="maintenanceMode" class="text-gray-700">Enable maintenance mode</label>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-2">When enabled, only admins can access the website.</p>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Settings</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function saveSettings() {
            try {
                const form = document.getElementById('settings-form');
                const formData = new FormData(form);
                const settings = {};
                
                for (let [key, value] of formData.entries()) {
                    settings[key] = value;
                }
                
                settings.maintenanceMode = document.getElementById('maintenanceMode').checked;
                settings.updatedAt = Date.now();
                
                await database.ref('settings').set(settings);
                Toast.show('Settings saved successfully!', 'success');
            } catch (error) {
                Toast.show('Error saving settings: ' + error.message, 'error');
            }
        }
        
        // ========== ANALYTICS ==========
        
        async function loadAnalytics() {
            const contentArea = document.getElementById('content-area');
            
            try {
                const [contacts, leads, blogPosts] = await Promise.all([
                    database.ref('contacts').once('value'),
                    database.ref('leads').once('value'),
                    database.ref('blog/posts').once('value')
                ]);
                
                const stats = {
                    totalContacts: contacts.numChildren(),
                    totalLeads: leads.numChildren(),
                    totalBlogPosts: blogPosts.numChildren(),
                    newLeads: Object.values(leads.val() || {}).filter(lead => lead.status === 'new').length,
                    convertedLeads: Object.values(leads.val() || {}).filter(lead => lead.status === 'converted').length
                };
                
                contentArea.innerHTML = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Analytics Dashboard</h2>
                                <p class="text-gray-600">Website performance insights</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Total Contacts</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.totalContacts}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-envelope text-blue-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Total Leads</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.totalLeads}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-users text-green-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">New Leads</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.newLeads}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-user-plus text-yellow-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Converted Leads</p>
                                        <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.convertedLeads}</h3>
                                    </div>
                                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-check-circle text-purple-600 text-xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Lead Status Distribution</h3>
                                <canvas id="leadChart" height="250"></canvas>
                            </div>
                            <div class="bg-white rounded-xl border border-gray-200 p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Popular Blog Categories</h3>
                                <canvas id="blogChart" height="250"></canvas>
                            </div>
                        </div>
                        
                        <div class="mt-6 bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h3>
                            <div class="space-y-4">
                                ${getRecentActivity()}
                            </div>
                        </div>
                    </div>
                `;
                
                // Initialize charts
                setTimeout(() => {
                    initCharts(leads.val() || {}, blogPosts.val() || {});
                }, 100);
                
            } catch (error) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700">Error Loading Analytics</h3>
                        <p class="text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function initCharts(leads, blogPosts) {
            // Lead Status Chart
            const leadStatusCount = {
                new: 0,
                contacted: 0,
                quoted: 0,
                converted: 0,
                lost: 0
            };
            
            Object.values(leads).forEach(lead => {
                leadStatusCount[lead.status] = (leadStatusCount[lead.status] || 0) + 1;
            });
            
            const leadCtx = document.getElementById('leadChart').getContext('2d');
            new Chart(leadCtx, {
                type: 'doughnut',
                data: {
                    labels: ['New', 'Contacted', 'Quoted', 'Converted', 'Lost'],
                    datasets: [{
                        data: [
                            leadStatusCount.new,
                            leadStatusCount.contacted,
                            leadStatusCount.quoted,
                            leadStatusCount.converted,
                            leadStatusCount.lost
                        ],
                        backgroundColor: [
                            '#3b82f6',
                            '#f59e0b',
                            '#8b5cf6',
                            '#10b981',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Blog Categories Chart
            const blogCategoryCount = {};
            Object.values(blogPosts).forEach(post => {
                const category = post.category || 'Uncategorized';
                blogCategoryCount[category] = (blogCategoryCount[category] || 0) + 1;
            });
            
            const blogCtx = document.getElementById('blogChart').getContext('2d');
            new Chart(blogCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(blogCategoryCount),
                    datasets: [{
                        label: 'Posts',
                        data: Object.values(blogCategoryCount),
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        function getRecentActivity() {
            return `
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user-plus text-green-600"></i>
                    </div>
                    <div>
                        <p class="font-medium">New lead registered</p>
                        <p class="text-sm text-gray-600">2 hours ago</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-blog text-blue-600"></i>
                    </div>
                    <div>
                        <p class="font-medium">New blog post published</p>
                        <p class="text-sm text-gray-600">1 day ago</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-star text-purple-600"></i>
                    </div>
                    <div>
                        <p class="font-medium">New testimonial added</p>
                        <p class="text-sm text-gray-600">3 days ago</p>
                    </div>
                </div>
            `;
        }
        
        // ========== UTILITY FUNCTIONS ==========
        
        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });
        
    </script>
</body>
                    </html>
